<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>小豆腐後台｜進階編輯系統</title>
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- Quill 編輯器樣式與腳本 -->
  <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
  <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
  <!-- Lucide Icons -->
  <script src="https://unpkg.com/lucide@latest"></script>

  <style>
    :root { --accent: #8D7B68; --sidebar-bg: #F5F2F0; }
    body { background: #fdfaf5; color: #54473F; font-family: sans-serif; }
    
    .sidebar-link {
      display: flex; align-items: center; gap: 12px; padding: 12px 16px;
      border-radius: 12px; transition: 0.3s; cursor: pointer; color: #786D66; font-weight: 500;
    }
    .sidebar-link:hover { background: rgba(141, 123, 104, 0.05); color: var(--accent); }
    .sidebar-link.active { background: var(--accent); color: white; }

    .main-panel { display: none; animation: fadeIn 0.3s ease-out; }
    .main-panel.active { display: block; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

    .card { background: white; border-radius: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.02); border: 1px solid #F0ECE9; }
    .input-field { width: 100%; padding: 12px; border: 1px solid #E5E1DE; border-radius: 12px; outline: none; transition: 0.3s; }
    .input-field:focus { border-color: var(--accent); box-shadow: 0 0 0 3px rgba(141, 123, 104, 0.1); }
    
    .btn-primary { background: var(--accent); color: white; padding: 10px 20px; border-radius: 10px; font-weight: bold; transition: 0.3s; }
    .btn-primary:hover { filter: brightness(1.1); }
    
    /* 編輯器容器高度與樣式微調 */
    #editor-container { height: 500px; border-bottom-left-radius: 12px; border-bottom-right-radius: 12px; font-size: 16px; background: white; }
    .ql-editor table { border-collapse: collapse; width: 100%; margin: 10px 0; }
    .ql-editor td { border: 1px solid #ccc; padding: 4px 8px; }
  </style>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { getFirestore, collection, addDoc, updateDoc, deleteDoc, doc, onSnapshot, query, orderBy, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
    import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAcYPHZJcSTBRbhKy018keO7FiPyzb4c84",
      authDomain: "tax-tofu.firebaseapp.com",
      projectId: "tax-tofu",
      storageBucket: "tax-tofu.firebasestorage.app",
      messagingSenderId: "1031361168988",
      appId: "1:1031361168988:web:ce06888cfd84de93958899"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);
    const appId = "tax-tofu";

    let allCategories = [];
    let allArticles = [];
    let allTools = [];
    let allForms = [];

    // 初始化 Quill 
    window.quill = new Quill('#editor-container', {
      modules: { 
        toolbar: [
          [{ 'header': [1, 2, 3, 4, false] }],
          [{ 'size': ['small', false, 'large', 'huge'] }],
          ['bold', 'italic', 'underline', 'strike'],
          [{ 'color': [] }, { 'background': [] }],
          [{ 'list': 'ordered'}, { 'list': 'bullet' }],
          [{ 'align': [] }],
          ['link', 'image', 'video'],
          ['blockquote', 'code-block'],
          ['clean']
        ] 
      },
      placeholder: '在這裡編寫您的稅務知識內容...',
      theme: 'snow'
    });

    // 匿名登入
    signInAnonymously(auth).catch(err => console.error(err));

    // --- 數據監聽 ---
    onSnapshot(query(collection(db, 'artifacts', appId, 'public', 'data', 'categories'), orderBy('weight', 'asc')), (snap) => {
      allCategories = snap.docs.map(doc => ({ id: doc.id, ...doc.data() }));
      renderCategoryCheckboxes();
      renderCategoryList();
      renderFilterSelects();
    });

    onSnapshot(query(collection(db, 'artifacts', appId, 'public', 'data', 'articles'), orderBy('createdAt', 'desc')), (snap) => {
      allArticles = snap.docs.map(doc => ({ id: doc.id, ...doc.data() }));
      renderArticleList();
    });

    onSnapshot(query(collection(db, 'artifacts', appId, 'public', 'data', 'tools'), orderBy('createdAt', 'desc')), (snap) => {
      allTools = snap.docs.map(doc => ({ id: doc.id, ...doc.data() }));
      renderToolList();
    });

    // 監聽表單數據 (依名稱排序)
    onSnapshot(query(collection(db, 'artifacts', appId, 'public', 'data', 'forms'), orderBy('name', 'asc')), (snap) => {
      allForms = snap.docs.map(doc => ({ id: doc.id, ...doc.data() }));
      renderFormList();
    });

    // --- 將函數掛載到 window 以供 HTML onclick 使用 ---
    window.switchTab = (tabId) => {
      document.querySelectorAll('.sidebar-link').forEach(el => el.classList.remove('active'));
      const activeTab = document.querySelector(`[data-tab="${tabId}"]`);
      if(activeTab) activeTab.classList.add('active');
      document.querySelectorAll('.main-panel').forEach(el => el.classList.remove('active'));
      const panel = document.getElementById(`panel-${tabId}`);
      if(panel) panel.classList.add('active');
    };

    window.checkPassword = () => {
      const pwInput = document.getElementById('pw');
      if(pwInput.value === "8888") {
        document.getElementById('gate').style.display = 'none';
        document.getElementById('app').classList.remove('hidden');
        lucide.createIcons();
      } else {
        alert("密碼錯誤");
      }
    };

    // --- 渲染功能 ---
    function renderCategoryCheckboxes() {
      const artContainer = document.getElementById('art-cat-checks');
      const toolContainer = document.getElementById('tool-cat-checks');
      const formContainer = document.getElementById('form-cat-checks');
      if(!artContainer || !toolContainer || !formContainer) return;

      const html = allCategories.map(cat => `
        <label class="inline-flex items-center p-2 bg-stone-50 rounded-lg border border-stone-200 cursor-pointer hover:bg-amber-50">
          <input type="checkbox" value="${cat.id}" class="cat-checkbox mr-2">
          <span class="text-xs font-bold">${cat.name} <span class="text-[9px] text-stone-300">#${cat.weight}</span></span>
        </label>
      `).join('');
      artContainer.innerHTML = html;
      toolContainer.innerHTML = html;
      formContainer.innerHTML = html;
    }

    function renderFilterSelects() {
      const artFilter = document.getElementById('art-filter');
      const toolFilter = document.getElementById('tool-filter');
      const formFilter = document.getElementById('form-filter');
      if(!artFilter || !toolFilter || !formFilter) return;

      const options = '<option value="all">所有標籤篩選</option>' + allCategories.map(c => `<option value="${c.id}">${c.name}</option>`).join('');
      artFilter.innerHTML = options;
      toolFilter.innerHTML = options;
      formFilter.innerHTML = options;
    }

    window.renderArticleList = () => {
      const filter = document.getElementById('art-filter')?.value || 'all';
      const filtered = filter === 'all' ? allArticles : allArticles.filter(a => (a.categoryIds || []).includes(filter));
      document.getElementById('art-list-container').innerHTML = filtered.map(a => `
        <div class="p-4 border-b flex justify-between items-center hover:bg-stone-50 transition">
          <div class="truncate pr-4">
            <div class="flex gap-1 mb-1">${getBadges(a.categoryIds)}</div>
            <p class="font-bold text-stone-700 truncate">${a.title}</p>
          </div>
          <div class="flex gap-4 shrink-0">
            <button onclick="editArticle('${a.id}')" class="text-amber-600 font-bold text-sm">修改</button>
            <button onclick="deleteItem('articles', '${a.id}')" class="text-red-300 text-sm">刪除</button>
          </div>
        </div>
      `).join('');
    };

    window.renderToolList = () => {
      const filter = document.getElementById('tool-filter')?.value || 'all';
      const filtered = filter === 'all' ? allTools : allTools.filter(t => (t.categoryIds || []).includes(filter));
      document.getElementById('tool-list-container').innerHTML = filtered.map(t => `
        <div class="p-4 border-b flex justify-between items-center hover:bg-stone-50 transition">
          <div class="truncate pr-4">
            <div class="flex gap-1 mb-1">${getBadges(t.categoryIds)}</div>
            <p class="font-bold text-stone-700 truncate">${t.name}</p>
          </div>
          <div class="flex gap-4 shrink-0">
            <button onclick="editTool('${t.id}')" class="text-amber-600 font-bold text-sm">修改</button>
            <button onclick="deleteItem('tools', '${t.id}')" class="text-red-300 text-sm">刪除</button>
          </div>
        </div>
      `).join('');
    };

    window.renderFormList = () => {
      const filter = document.getElementById('form-filter')?.value || 'all';
      const filtered = filter === 'all' ? allForms : allForms.filter(f => (f.categoryIds || []).includes(filter));
      document.getElementById('form-list-container').innerHTML = filtered.map(f => `
        <div class="p-4 border-b flex justify-between items-center hover:bg-stone-50 transition">
          <div class="truncate pr-4">
            <div class="flex gap-1 mb-1">${getBadges(f.categoryIds)}</div>
            <p class="font-bold text-stone-700 truncate">${f.name}</p>
          </div>
          <div class="flex gap-4 shrink-0">
            <button onclick="editForm('${f.id}')" class="text-amber-600 font-bold text-sm">修改</button>
            <button onclick="deleteItem('forms', '${f.id}')" class="text-red-300 text-sm">刪除</button>
          </div>
        </div>
      `).join('');
    };

    function renderCategoryList() {
      document.getElementById('cat-list-container').innerHTML = allCategories.map(c => `
        <div class="p-4 border-b flex justify-between items-center">
          <div class="flex items-center gap-4">
            <span class="bg-stone-100 text-stone-500 px-2 py-1 rounded text-xs font-black">序號 ${c.weight}</span>
            <span class="font-bold">${c.name}</span>
          </div>
          <div class="flex gap-4">
            <button onclick="prepareEditCat('${c.id}', '${c.name}', ${c.weight})" class="text-amber-600 text-sm">修改</button>
            <button onclick="deleteItem('categories', '${c.id}')" class="text-red-300 text-sm">刪除</button>
          </div>
        </div>
      `).join('');
    }

    function getBadges(ids) {
      if(!ids || ids.length === 0) return `<span class="px-2 py-0.5 bg-stone-100 text-stone-400 text-[10px] rounded font-bold">一般</span>`;
      return ids.map(id => {
        const name = allCategories.find(c => c.id === id)?.name || "一般";
        return `<span class="px-2 py-0.5 bg-amber-50 text-amber-600 text-[10px] rounded font-bold">${name}</span>`;
      }).join('');
    }

    // --- 儲存邏輯 ---
    window.saveArticle = async () => {
      const id = document.getElementById('art-id').value;
      const title = document.getElementById('art-title').value;
      const content = window.quill.root.innerHTML;
      const categoryIds = Array.from(document.querySelectorAll('#art-cat-checks input:checked')).map(el => el.value);
      if(!title || window.quill.getText().trim() === "") return alert("請填寫標題與內容");
      
      const data = { title, content, categoryIds: categoryIds.length ? categoryIds : ["general"], updatedAt: serverTimestamp() };
      try {
        if(id) await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'articles', id), data);
        else await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'articles'), { ...data, createdAt: serverTimestamp() });
        window.resetArticleForm(); alert("文章儲存成功！");
      } catch (e) { alert("儲存失敗"); console.error(e); }
    }

    window.saveTool = async () => {
      const id = document.getElementById('tool-id').value;
      const name = document.getElementById('tool-name').value;
      const link = document.getElementById('tool-link').value;
      const description = document.getElementById('tool-desc').value;
      const categoryIds = Array.from(document.querySelectorAll('#tool-cat-checks input:checked')).map(el => el.value);
      if(!name || !link) return alert("請填寫名稱與網址");
      
      const data = { name, link, description, categoryIds: categoryIds.length ? categoryIds : ["general"], updatedAt: serverTimestamp() };
      try {
        if(id) await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'tools', id), data);
        else await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'tools'), { ...data, createdAt: serverTimestamp() });
        window.resetToolForm(); alert("工具儲存成功！");
      } catch (e) { alert("儲存失敗"); console.error(e); }
    }

    window.saveForm = async () => {
      const id = document.getElementById('form-id').value;
      const name = document.getElementById('form-name').value;
      const link = document.getElementById('form-link').value;
      const description = document.getElementById('form-desc').value;
      const categoryIds = Array.from(document.querySelectorAll('#form-cat-checks input:checked')).map(el => el.value);
      if(!name || !link) return alert("請填寫表單名稱與網址");
      
      const data = { name, link, description, categoryIds: categoryIds.length ? categoryIds : ["general"], updatedAt: serverTimestamp() };
      try {
        if(id) await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'forms', id), data);
        else await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'forms'), { ...data, createdAt: serverTimestamp() });
        window.resetFormForm(); alert("常用表單儲存成功！");
      } catch (e) { alert("儲存失敗"); console.error(e); }
    }

    window.saveCategory = async () => {
      const id = document.getElementById('cat-id').value;
      const name = document.getElementById('cat-name').value;
      const weight = parseInt(document.getElementById('cat-weight').value) || 0;
      if(!name) return;
      try {
        if(id) await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'categories', id), { name, weight });
        else await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'categories'), { name, weight, createdAt: serverTimestamp() });
        document.getElementById('cat-id').value = ""; document.getElementById('cat-name').value = ""; document.getElementById('cat-weight').value = 0;
        alert("標籤設定已更新");
      } catch (e) { alert("儲存失敗"); console.error(e); }
    }

    // --- 編輯功能 ---
    window.editArticle = (id) => {
      const a = allArticles.find(x => x.id === id);
      if(!a) return;
      document.getElementById('art-id').value = id;
      document.getElementById('art-title').value = a.title;
      window.quill.root.innerHTML = a.content;
      document.querySelectorAll('#art-cat-checks input').forEach(el => el.checked = (a.categoryIds || []).includes(el.value));
      document.getElementById('art-form-title').innerText = "修改新知文章";
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    window.editTool = (id) => {
      const t = allTools.find(x => x.id === id);
      if(!t) return;
      document.getElementById('tool-id').value = id;
      document.getElementById('tool-name').value = t.name;
      document.getElementById('tool-link').value = t.link;
      document.getElementById('tool-desc').value = t.description;
      document.querySelectorAll('#tool-cat-checks input').forEach(el => el.checked = (t.categoryIds || []).includes(el.value));
      document.getElementById('tool-btn-text').innerText = "更新工具";
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    window.editForm = (id) => {
      const f = allForms.find(x => x.id === id);
      if(!f) return;
      document.getElementById('form-id').value = id;
      document.getElementById('form-name').value = f.name;
      document.getElementById('form-link').value = f.link;
      document.getElementById('form-desc').value = f.description;
      document.querySelectorAll('#form-cat-checks input').forEach(el => el.checked = (f.categoryIds || []).includes(el.value));
      document.getElementById('form-btn-text').innerText = "更新表單";
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    window.prepareEditCat = (id, name, weight) => {
      document.getElementById('cat-id').value = id;
      document.getElementById('cat-name').value = name;
      document.getElementById('cat-weight').value = weight;
      window.scrollTo({ top: 0, behavior: 'smooth' });
    };

    window.deleteItem = async (type, id) => {
      if(confirm("確定刪除？此動作無法復原。")) await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', type, id));
    };

    window.resetArticleForm = () => {
      document.getElementById('art-id').value = ""; document.getElementById('art-title').value = "";
      window.quill.setContents([]);
      document.querySelectorAll('#art-cat-checks input').forEach(el => el.checked = false);
      document.getElementById('art-form-title').innerText = "撰寫新知文章";
    };

    window.resetToolForm = () => {
      document.getElementById('tool-id').value = ""; document.getElementById('tool-name').value = "";
      document.getElementById('tool-link').value = ""; document.getElementById('tool-desc').value = "";
      document.querySelectorAll('#tool-cat-checks input').forEach(el => el.checked = false);
      document.getElementById('tool-btn-text').innerText = "發佈工具";
    };

    window.resetFormForm = () => {
      document.getElementById('form-id').value = ""; document.getElementById('form-name').value = "";
      document.getElementById('form-link').value = ""; document.getElementById('form-desc').value = "";
      document.querySelectorAll('#form-cat-checks input').forEach(el => el.checked = false);
      document.getElementById('form-btn-text').innerText = "發佈表單";
    };

  </script>
</head>
<body>

  <!-- 密碼閘門 -->
  <div id="gate" class="fixed inset-0 bg-stone-100 z-[9999] flex items-center justify-center">
    <div class="bg-white p-10 rounded-[32px] shadow-2xl text-center w-96 border border-stone-200">
      <div class="w-16 h-16 bg-amber-100 rounded-2xl flex items-center justify-center mx-auto mb-6 text-amber-600">
        <i data-lucide="lock" size="32"></i>
      </div>
      <h2 class="text-2xl font-black mb-6">管理者驗證</h2>
      <input type="password" id="pw" placeholder="請輸入管理密碼" class="w-full p-4 border rounded-2xl text-center mb-6 outline-none focus:border-amber-500">
      <button onclick="checkPassword()" class="btn-primary w-full py-4 text-lg">進入管理中樞</button>
    </div>
  </div>

  <div id="app" class="hidden flex min-h-screen">
    
    <!-- 側邊欄 -->
    <aside class="w-64 bg-stone-100 border-r border-stone-200 p-6 flex flex-col shrink-0">
      <div class="mb-10 px-2">
        <h1 class="text-xl font-black text-stone-800">稅務小豆腐</h1>
        <p class="text-[10px] text-stone-400 font-bold uppercase tracking-widest mt-1">Admin Dashboard</p>
      </div>

      <nav class="space-y-2 flex-1">
        <div onclick="switchTab('write')" data-tab="write" class="sidebar-link active">
          <i data-lucide="pen-tool" size="18"></i> 稅務新知發佈
        </div>
        <div onclick="switchTab('tools')" data-tab="tools" class="sidebar-link">
          <i data-lucide="wrench" size="18"></i> 稅務小工具管理
        </div>
        <div onclick="switchTab('forms')" data-tab="forms" class="sidebar-link">
          <i data-lucide="file-text" size="18"></i> 常用表單管理
        </div>
        <div onclick="switchTab('tags')" data-tab="tags" class="sidebar-link">
          <i data-lucide="tags" size="18"></i> 標籤系統維護
        </div>
      </nav>

      <button onclick="location.reload()" class="mt-auto sidebar-link text-red-400">
        <i data-lucide="log-out" size="18"></i> 登出系統
      </button>
    </aside>

    <!-- 主內容區 -->
    <main class="flex-1 p-8 lg:p-12 overflow-y-auto">
      
      <!-- 1. 新知面板 -->
      <section id="panel-write" class="main-panel active">
        <div class="grid grid-cols-1 xl:grid-cols-12 gap-8">
          <div class="xl:col-span-8">
            <div class="card p-8">
              <h2 id="art-form-title" class="text-2xl font-black mb-6">撰寫新知文章</h2>
              <input type="hidden" id="art-id">
              <div class="space-y-6">
                <div>
                  <label class="block text-xs font-bold text-stone-400 mb-2">文章標題</label>
                  <input type="text" id="art-title" class="input-field text-lg font-bold" placeholder="例如：113年綜所稅申報懶人包">
                </div>
                <div>
                  <label class="block text-xs font-bold text-stone-400 mb-2">選擇適用標籤 (可多選)</label>
                  <div id="art-cat-checks" class="flex flex-wrap gap-2"></div>
                </div>
                <div>
                  <div id="editor-container"></div>
                </div>
                <div class="flex gap-4">
                  <button onclick="saveArticle()" class="btn-primary flex-1">儲存並發佈文章</button>
                  <button onclick="resetArticleForm()" class="px-6 py-2 text-stone-400 font-bold text-sm">重設</button>
                </div>
              </div>
            </div>
          </div>
          <div class="xl:col-span-4">
            <div class="card p-6 h-full flex flex-col">
              <div class="flex justify-between items-center mb-6">
                <h3 class="font-black text-lg">文章資料庫</h3>
                <select id="art-filter" onchange="renderArticleList()" class="text-xs p-1.5 border rounded-lg"></select>
              </div>
              <div id="art-list-container" class="space-y-1 overflow-y-auto flex-1"></div>
            </div>
          </div>
        </div>
      </section>

      <!-- 2. 工具面板 -->
      <section id="panel-tools" class="main-panel">
        <div class="grid grid-cols-1 xl:grid-cols-12 gap-8">
          <div class="xl:col-span-7">
            <div class="card p-8">
              <h2 class="text-2xl font-black mb-6">發佈稅務小工具</h2>
              <input type="hidden" id="tool-id">
              <div class="space-y-6">
                <input type="text" id="tool-name" class="input-field" placeholder="工具名稱 (如：健保費率試算)">
                <input type="text" id="tool-link" class="input-field" placeholder="外部網址 (https://...)">
                <textarea id="tool-desc" class="input-field h-24" placeholder="簡短介紹內容..."></textarea>
                
                <div>
                  <label class="block text-xs font-bold text-stone-400 mb-2 uppercase tracking-widest">適用標籤</label>
                  <div id="tool-cat-checks" class="flex flex-wrap gap-2"></div>
                </div>

                <div class="flex gap-4">
                  <button onclick="saveTool()" class="btn-primary flex-1"><span id="tool-btn-text">發佈工具</span></button>
                  <button onclick="resetToolForm()" class="text-stone-400 text-sm">取消修改</button>
                </div>
              </div>
            </div>
          </div>
          <div class="xl:col-span-5">
            <div class="card p-6 h-full flex flex-col">
              <div class="flex justify-between items-center mb-6">
                <h3 class="font-black text-lg">現有工具</h3>
                <select id="tool-filter" onchange="renderToolList()" class="text-xs p-1.5 border rounded-lg"></select>
              </div>
              <div id="tool-list-container" class="space-y-1 flex-1 overflow-y-auto"></div>
            </div>
          </div>
        </div>
      </section>

      <!-- 常用表單管理面板 -->
      <section id="panel-forms" class="main-panel">
        <div class="grid grid-cols-1 xl:grid-cols-12 gap-8">
          <div class="xl:col-span-7">
            <div class="card p-8">
              <h2 class="text-2xl font-black mb-6">管理常用表單</h2>
              <input type="hidden" id="form-id">
              <div class="space-y-6">
                <input type="text" id="form-name" class="input-field" placeholder="表單名稱 (如：綜所稅更正申請書)">
                <input type="text" id="form-link" class="input-field" placeholder="下載或連結網址 (https://...)">
                <textarea id="form-desc" class="input-field h-24" placeholder="表單用途說明..."></textarea>
                
                <div>
                  <label class="block text-xs font-bold text-stone-400 mb-2 uppercase tracking-widest">分類標籤</label>
                  <div id="form-cat-checks" class="flex flex-wrap gap-2"></div>
                </div>

                <div class="flex gap-4">
                  <button onclick="saveForm()" class="btn-primary flex-1"><span id="form-btn-text">發佈表單</span></button>
                  <button onclick="resetFormForm()" class="text-stone-400 text-sm">重設表單</button>
                </div>
              </div>
            </div>
          </div>
          <div class="xl:col-span-5">
            <div class="card p-6 h-full flex flex-col">
              <div class="flex justify-between items-center mb-6">
                <h3 class="font-black text-lg">表單清單 (名稱排序)</h3>
                <select id="form-filter" onchange="renderFormList()" class="text-xs p-1.5 border rounded-lg"></select>
              </div>
              <div id="form-list-container" class="space-y-1 flex-1 overflow-y-auto"></div>
            </div>
          </div>
        </div>
      </section>

      <!-- 3. 標籤面板 -->
      <section id="panel-tags" class="main-panel">
        <div class="max-w-4xl mx-auto">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
            <div class="card p-8">
              <h2 class="text-2xl font-black mb-6">建立新標籤</h2>
              <p class="text-xs text-stone-400 mb-4 italic">小技巧：序號越小排越前面 (如 1, 2, 3...)</p>
              <input type="hidden" id="cat-id">
              <div class="space-y-4">
                <div>
                  <label class="block text-xs font-bold text-stone-400 mb-2">標籤名稱</label>
                  <input type="text" id="cat-name" class="input-field" placeholder="標籤名稱 (如：綜所稅)">
                </div>
                <div>
                  <label class="block text-xs font-bold text-stone-400 mb-2">權重序號 (越小越靠前)</label>
                  <input type="number" id="cat-weight" class="input-field" placeholder="例如：1">
                </div>
                <button onclick="saveCategory()" class="btn-primary w-full py-4 mt-4">儲存標籤設定</button>
              </div>
            </div>
            <div class="card p-8 flex flex-col">
              <h2 class="text-2xl font-black mb-6">所有標籤列表</h2>
              <div id="cat-list-container" class="divide-y overflow-y-auto max-h-[500px]"></div>
            </div>
          </div>
        </div>
      </section>

    </main>
  </div>

  <script>
    window.addEventListener('DOMContentLoaded', () => { 
      lucide.createIcons(); 
    });
  </script>
</body>
</html>
